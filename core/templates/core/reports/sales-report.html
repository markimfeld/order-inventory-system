{% extends 'list.html' %}

{% load static %}

{% block extra-head %}
 <!-- daterange picker -->
 <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">
<!-- Tempusdominus Bbootstrap 4 -->
<link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
<!-- Select2 -->
<link rel="stylesheet" href="{% static 'plugins/select2/css/select2.min.css' %}">
<link rel="stylesheet" href="{% static 'plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css' %}">
{% endblock %} 

{% block breadcrumb-page %}
    Reporte de Ventas
{% endblock %}

{% block filters %}
 <!-- Date range -->
<form id="dateRangeForm" method="get">
    <div class="form-group">
      <label>Date range:</label>

      <div class="input-group">
        <div class="input-group-prepend">
          <span class="input-group-text">
            <i class="far fa-calendar-alt"></i>
          </span>
        </div>
        <input type="text" class="form-control float-right" id="filter-date">
      </div>
      <!-- /.input group -->
    </div>
    <!-- /.form group -->
    <input name="startDate" type="hidden" id="startDate">
    <input name="endDate" type="hidden" id="endDate">
</form>
{% endblock %}

{% block messages %}
    <div class="row">
        {% if messages %}
            <div class="col">
                {% for message in messages %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <strong>{{ message }}</strong> 
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block title %}
    <i class="fas fa-search"></i> Lista de Ventas
{% endblock %}

{% block columns %}
    <th width="90px">Nro</th>
    <th>Cliente</th>
    <th>Ciudad</th>
    <th>Fecha de registro</th>
    <th class="text-center">Cantidad</th>
    <th class="text-center">Total</th>
{% endblock %}

{% block rows %}

    {% for sale in sales %}
        <tr>
            <td>{{ sale.id }}</td>
            <td>{{ sale.customer.full_name.upper }}</td>
            <td>{{ sale.customer.address.city.name.upper }}</td>
            <td>{{ sale.created_at }}</td>
            <td class="text-center">{{ sale.get_products_quantity }}</td>
            <td class="text-center">${{ sale.total }}</td>
        </tr>
    {% endfor %}
{% endblock %}


{% block tfoot %}
    <tr>
        <!--<td style="border-top: 3px solid #DEE2E6;"></td>
        <td style="border-top: 3px solid #DEE2E6;"></td>
        <td style="border-top: 3px solid #DEE2E6;"></td>-->
        <!--<th style="border-top: 3px solid #DEE2E6;" class="h6 text-bold">{{ products_sold_total }}</th>-->
        <th style="border-top: 5px solid #DEE2E6;" class="h6 text-bold">Total</th>
        <th style="border-top: 5px solid #DEE2E6;" class="h6 text-bold">${{ total_incomes }}</th>
        <th style="border-top: 5px solid #DEE2E6;" class="h6 text-bold">Costo</th>
        <th style="border-top: 5px solid #DEE2E6;" class="h6 text-bold">${{ total_cost }}</th>
        <th style="border-top: 5px solid #DEE2E6;" class="h6 text-bold">Utilidad</th>
        <th style="border-top: 5px solid #DEE2E6;" class="h6 text-bold">${{ revenue }}</th>
    </tr>
    <!--<tr>
        <td></td>
        <td></td>
        <td></td>
        <th class="text-right h6 text-bold">Costo</th>
        <th class="text-center h6 text-bold">-</th>
        <th class="text-center h6 text-bold">${{ total_cost }}</th>
    </tr>
    <tr>
        <td></td>
        <td></td>
        <td></td>
        <th class="text-right h6 text-bold">Utilidad</th>
        <th class="text-center h6 text-bold">-</th>
        <th class="text-center h6 text-bold">${{ revenue }}</th>
    </tr>-->
{% endblock tfoot %}

{% block extras %}
{% endblock %}


{% block extra-js %}

<!-- InputMask -->
<script src="{% static 'plugins/moment/moment.min.js' %}"></script>
<script src="{% static 'plugins/inputmask/min/jquery.inputmask.bundle.min.js' %}"></script>
<!-- date-range-picker -->
<script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
<!-- Select2 -->
<script src="{% static 'plugins/select2/js/select2.full.min.js' %}"></script>


<script>
    $(document).ready(function() {
        $('.alert').alert('close');


        //Date range picker
        $('#filter-date').daterangepicker();

        $('#filter-date').on('apply.daterangepicker', function(ev, picker){
            const startDate = $('#startDate').val(picker.startDate.format('YYYY-MM-DD'));
            const endDate = $('#endDate').val(picker.endDate.format('YYYY-MM-DD'));

            $('#dateRangeForm').submit();
        });

    });

</script>

{% endblock extra-js %}
